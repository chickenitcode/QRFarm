<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Farm - Transparent Agricultural Supply Chain</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #0a7ea4;
            color: white;
            padding: 20px 0;
            text-align: center;
        }
        .hero {
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1504057489879-8de808f540a9?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            padding: 100px 20px;
            text-align: center;
            color: white;
        }
        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }
        .hero p {
            font-size: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .search-container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            margin-top: -50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .search-container h2 {
            margin-top: 0;
            color: #0a7ea4;
        }
        .search-form {
            display: flex;
            margin-top: 20px;
        }
        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .search-button {
            background-color: #0a7ea4;
            color: white;
            border: none;
            padding: 12px 20px;
            margin-left: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .features {
            display: flex;
            flex-wrap: wrap;
            margin: 50px 0;
            justify-content: space-between;
        }
        .feature {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            width: calc(33.333% - 20px);
            box-sizing: border-box;
        }
        .feature-icon {
            font-size: 36px;
            color: #0a7ea4;
            margin-bottom: 15px;
        }
        .recent-batches {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            margin: 50px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .batch-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .batch-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .batch-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .batch-id {
            color: #0a7ea4;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .batch-detail {
            margin: 5px 0;
            font-size: 14px;
        }
        .view-batch {
            display: inline-block;
            margin-top: 15px;
            padding: 8px 15px;
            background-color: #0a7ea4;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        footer {
            background-color: #333;
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-top: 50px;
        }
        
        @media (max-width: 768px) {
            .feature {
                width: 100%;
            }
            .hero h1 {
                font-size: 32px;
            }
            .hero p {
                font-size: 16px;
            }
        }
    </style>
    <script type="module">
        import { getAllBatches } from './api.js';
        
        document.addEventListener('DOMContentLoaded', async function() {
            // Set up search functionality
            const searchButton = document.getElementById('search-button');
            const searchInput = document.getElementById('search-input');
            
            searchButton.addEventListener('click', function() {
                const searchValue = searchInput.value.trim();
                if (!searchValue) {
                    alert('Please enter a valid Batch ID or Product ID');
                    return;
                }
                
                // Redirect based on ID format
                if (searchValue.startsWith('BATCH-')) {
                    window.location.href = `./batch.html?id=${searchValue}`;
                } else if (searchValue.startsWith('PROD-')) {
                    window.location.href = `./product.html?id=${searchValue}`;
                } else {
                    alert('Invalid ID format. IDs should start with BATCH- or PROD-');
                }
            });
            
            // Allow pressing Enter to search
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchButton.click();
                }
            });
            
            try {
                // Load recent batches
                const batches = await getAllBatches();
                displayRecentBatches(batches);
            } catch (error) {
                console.error('Error fetching recent batches:', error);
                document.getElementById('batch-list').innerHTML = 
                    '<p>Error loading batches. Please try again later.</p>';
            }
        });
        
        // Your existing functions...
    </script>
</head>
<body>
    <header>
        <div class="container">
            <h1>QR Farm</h1>
            <p>Track your agricultural products from farm to table</p>
        </div>
    </header>
    
    <div class="hero">
        <h1>Transparent Supply Chain</h1>
        <p>Scan any QR code on our products to discover the complete journey - from harvest to your hands.</p>
    </div>
    
    <div class="container">
        <div class="search-container">
            <h2>Track Your Product</h2>
            <p>Enter a batch ID or product ID to view its complete journey</p>
            <div class="search-form">
                <input type="text" id="search-input" class="search-input" placeholder="Enter Batch ID or Product ID (e.g., BATCH-123ABC)">
                <button id="search-button" class="search-button">Track</button>
            </div>
        </div>
        
        <div class="features">
            <div class="feature">
                <div class="feature-icon">üå±</div>
                <h3>Farm to Table Tracking</h3>
                <p>Follow your food's journey from the farm through every stage of processing and delivery.</p>
            </div>
            <div class="feature">
                <div class="feature-icon">üîí</div>
                <h3>Secure Blockchain</h3>
                <p>Our product data is secured using a blockchain-like structure that ensures data integrity.</p>
            </div>
            <div class="feature">
                <div class="feature-icon">üåê</div>
                <h3>Global Network</h3>
                <p>Our network spans multiple countries, connecting producers directly with consumers.</p>
            </div>
        </div>
        
        <div class="recent-batches">
            <h2>Recent Batches</h2>
            <p>Check out our latest shipments and their journeys</p>
            <div id="batch-list" class="batch-list">
                <!-- Batches will be loaded here -->
                <div class="loading">Loading recent batches...</div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 QR Farm. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // API URL - Update this to your actual backend URL
        const API_BASE_URL = 'http://192.168.1.134:5000'; // For local testing
        // For production: const API_BASE_URL = 'https://your-api-domain.com';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Set up search functionality
            const searchButton = document.getElementById('search-button');
            const searchInput = document.getElementById('search-input');
            
            searchButton.addEventListener('click', function() {
                const searchValue = searchInput.value.trim();
                if (!searchValue) {
                    alert('Please enter a valid Batch ID or Product ID');
                    return;
                }
                
                // Redirect based on ID format
                if (searchValue.startsWith('BATCH-')) {
                    window.location.href = `./batch.html?id=${searchValue}`;
                } else if (searchValue.startsWith('PROD-')) {
                    window.location.href = `./product.html?id=${searchValue}`;
                } else {
                    alert('Invalid ID format. IDs should start with BATCH- or PROD-');
                }
            });
            
            // Allow pressing Enter to search
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchButton.click();
                }
            });
            
            // Load recent batches
            fetchRecentBatches();
        });
        
        async function fetchRecentBatches() {
            try {
                const response = await fetch(`${API_BASE_URL}/batches`);
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const batches = await response.json();
                displayRecentBatches(batches);
                
            } catch (error) {
                console.error('Error fetching recent batches:', error);
                document.getElementById('batch-list').innerHTML = 
                    '<p>Error loading batches. Please try again later.</p>';
            }
        }
        
        function displayRecentBatches(batches) {
            const batchList = document.getElementById('batch-list');
            batchList.innerHTML = '';
            
            // Limit to 6 most recent batches
            const recentBatches = batches.slice(0, 6);
            
            if (recentBatches.length === 0) {
                batchList.innerHTML = '<p>No batches available at the moment.</p>';
                return;
            }
            
            recentBatches.forEach(batch => {
                const batchId = batch._id || batch.id;
                const batchEl = document.createElement('div');
                batchEl.className = 'batch-card';
                
                batchEl.innerHTML = `
                    <div class="batch-id">${batchId}</div>
                    <div class="batch-detail"><strong>Product:</strong> ${batch.productType}</div>
                    <div class="batch-detail"><strong>Origin:</strong> ${batch.location}</div>
                    <div class="batch-detail"><strong>Harvested:</strong> ${formatDate(batch.harvestDate)}</div>
                    <div class="batch-detail"><strong>Quantity:</strong> ${batch.quantity} products</div>
                    <a href="./batch.html?id=${batchId}" class="view-batch">View Details</a>
                `;
                
                batchList.appendChild(batchEl);
            });
        }
        
        function formatDate(dateInput) {
            if (!dateInput) return 'Unknown';
            
            let date;
            if (typeof dateInput === 'number') {
                date = new Date(dateInput);
            } else {
                date = new Date(dateInput);
            }
            
            if (isNaN(date.getTime())) {
                return String(dateInput);
            }
            
            return date.toLocaleDateString();
        }
    </script>
</body>
</html>